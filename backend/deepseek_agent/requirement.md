# 旅行规划智能体产品需求文档（PDR）

## 1. 文档目的

本文件用于定义旅行规划智能体的产品需求边界，确保团队在用户价值、业务目标、功能范围、验收口径上达成一致。

本文档仅描述产品需求，不包含技术实现方案与技术选型。

---

## 2. 产品愿景

为自由行用户提供一个“可对话、可解释、可编辑”的旅行规划助手，帮助用户在信息过载的环境中快速产出可执行的行程方案，并通过真实证据支撑决策。

---

## 3. 目标用户与核心场景

### 3.1 目标用户 A：自由行旅行者

特征：
- 自主安排行程，不依赖跟团
- 搜集信息耗时高，跨平台比对成本高
- 需要在时间、预算、兴趣之间做平衡

典型场景：
- “我有 4 天假，预算有限，想去一个海边城市，帮我做计划。”
- “我不喜欢赶行程，想慢节奏 + 当地文化体验。”

### 3.2 目标用户 B：城市体验探索者

特征：
- 重点关注餐厅/景点/酒店与城市文化文娱项目
- 对“好不好、值不值、是否适合我”敏感
- 希望看到证据而非仅结论

典型场景：
- “这个城市哪些餐厅值得去？有没有本地人常去的？”
- “酒店和景点怎么搭配最省时间？”

---

## 4. 核心问题（Problem）

- 信息碎片化：同一旅行决策分散在多个平台，整合成本高。
- 证据不可用：很多推荐缺少来源与依据，用户难以判断可信度。
- 方案不可编辑：传统推荐往往是一次性结果，局部调整成本高。
- 约束不透明：预算、时间、偏好冲突时，缺少可解释的取舍过程。

---

## 5. 产品目标（MVP）与非目标

### 5.1 MVP 目标

- 生成结构化行程（按天 + 时段），可直接阅读与执行。
- 关键推荐项提供证据展示（评分、评论摘要、来源引用）。
- 支持在同一对话中连续优化行程（包含 Edit Day N，但不限制于 Day N）。
- 提供预算分项与风险提示（天气、拥堵、闭馆、超预算等）。
- 对话过程中反馈阶段状态，降低用户等待焦虑。

### 5.2 非目标（MVP 不包含）

- 预订交易闭环（下单、库存占用、支付）。
- 小时级强约束排程（精确到分钟）。
- 全量评论抓取与平台级数据沉淀。

---

## 6. 用户旅程（Scenario）

1. 用户输入出行需求（目的地/天数/预算/偏好/同伴类型）。
2. 系统澄清缺失信息（如交通偏好、住宿偏好、必去点）。
3. 系统输出首版行程（按天+时段）并展示证据与预算。
4. 用户继续通过多轮对话优化行程（例如“预算降到 5000”“第 2 天放松一点”“只问证据来源”）。
5. 系统识别本轮意图（create/edit/qa/reset），基于当前会话状态更新并回显差异。
6. 用户可在对话中持续迭代，必要时局部编辑（Edit Day N）或回滚到历史版本。
7. 用户确认最终方案并导出/保存。

---

## 7. 用户故事（SPEC 原则）

说明：
- S（Scenario）：使用场景
- P（Problem）：用户问题
- E（Expectation）：期望结果
- C（Criteria）：验收条件（Given/When/Then）

### 7.1 用户故事组 A（自由行旅行者）

#### US-A1（P0）
- 作为：自由行旅行者
- 我希望：输入目的地、天数、预算后快速获得完整行程草案
- 以便：减少跨平台搜集和拼接信息的时间

S/P/E：
- S：首次规划一个陌生城市行程
- P：不知道从哪里开始，信息太多
- E：10 分钟内得到可执行的初版计划

C（Given/When/Then）：
- Given 用户已提供基本约束（目的地、天数、预算）
- When 用户发起“生成行程”
- Then 系统返回按天+时段的可执行草案，并包含预算分项与风险提示

#### US-A2（P0）
- 作为：自由行旅行者
- 我希望：在同一会话中持续修改当前行程（包含但不限于 Edit Day N）
- 以便：快速迭代并保留已满意部分

S/P/E：
- S：用户希望连续多轮微调行程（预算、节奏、某天主题等）
- P：整份重算会导致上下文丢失和成本增加
- E：连续改动、全局一致

C（Given/When/Then）：
- Given 系统已存在多日行程草案
- When 用户发起连续编辑请求（如“预算降到5000”或“把第2天改亲子路线”）
- Then 系统基于当前版本行程增量更新并回显修改摘要；若为 Day N 编辑，非目标天保持稳定

#### US-A3（P1）
- 作为：自由行旅行者
- 我希望：在预算受限时获得替代方案
- 以便：在体验与成本之间做取舍

C（Given/When/Then）：
- Given 用户设置预算上限
- When 当前方案超预算
- Then 系统提供至少一组降本替代方案并说明影响

### 7.2 用户故事组 B（城市体验探索者）

#### US-B1（P0）
- 作为：城市体验探索者
- 我希望：每个推荐点都能看到证据来源
- 以便：判断推荐是否可信、是否符合口味

S/P/E：
- S：筛选餐厅/景点/酒店
- P：只给结论不可靠
- E：结论 + 证据并列展示

C（Given/When/Then）：
- Given 系统返回推荐候选
- When 用户查看候选详情
- Then 每个候选至少展示评分信息、评论摘要和来源归因

#### US-B2（P0）
- 作为：城市体验探索者
- 我希望：看到文化文娱项目与常规景点的组合建议
- 以便：获得更有当地特色的行程体验

C（Given/When/Then）：
- Given 用户偏好包含文化/文娱体验
- When 系统生成日程
- Then 每日至少包含 1 个符合偏好的体验型活动或明确给出原因

#### US-B3（P1）
- 作为：城市体验探索者
- 我希望：能比较多个候选路线
- 以便：在时间、体验、成本之间做选择

C（Given/When/Then）：
- Given 用户请求“对比方案”
- When 系统返回结果
- Then 至少提供 2 个可比较方案，并列出关键差异（时间/预算/亮点）

---

## 8. 功能需求（按优先级）

### 8.1 P0（MVP 必须）

- 需求输入：目的地、天数、预算、偏好、可选约束。
- 约束补全机制：当关键约束缺失时，系统必须优先追问再生成计划。
- 行程生成：按天+时段输出活动建议、通勤衔接、预算分项。
- 多轮会话编辑：支持在同一会话内连续优化行程，系统需识别 create/edit/qa/reset 并保持上下文一致。
- 证据展示：餐厅/景点/酒店推荐均需展示来源与归因。
- 局部编辑：支持 Edit Day N（作为连续编辑子能力），且保留非目标天内容。
- 风险提示：天气、营业时间冲突、通勤过长、预算超限等。
- 状态反馈：在生成过程中提供阶段性状态，最终返回结构化行程。

### 8.2 P1（增强）

- 多方案并行比较（快速版、深度体验版、预算优先版）。
- 偏好记忆（例如“少走路”“亲子友好”“夜生活偏好”）。
- 行程导出（分享/下载）。
- 深度研究模式：对复杂问题进行多来源核验与冲突信息对比，并输出依据说明。

---

## 9. 内容与证据展示规范

- 每条推荐必须支持“推荐结论 + 证据摘要 + 来源归因”。
- 证据摘要应可读、简洁，不堆砌原文。
- 当证据不足或冲突时，必须明确提示“信息不充分”。
- 用户导入链接或文本时，应保留“用户提供证据”标签。

### 9.1 Evidence v1 最小结构（MVP）

每条证据至少包含：
- `source_name`：来源名称（平台/用户导入）
- `source_type`：来源类型（平台评价/官方信息/用户导入）
- `evidence_snippet`：证据摘要文本
- `rating_or_score`：评分或可信度分值（无则置空）
- `timestamp_or_recency`：时间或时效标记（可为空）
- `source_url`：可追溯链接（无链接时注明“无外链”）
- `attribution_text`：归因文本（作者/平台/版权说明）

### 9.2 归因与跳转规则

- 证据卡片必须提供“查看来源”入口。
- 若可外链跳转，点击后在新窗口打开来源页面。
- 若不可外链（用户导入文本等），需展示“来源说明”弹层。
- 引用第三方内容时，必须在同屏可见位置展示归因文本。
- 推荐结论与证据之间需建立可见关联（例如“查看证据”锚点）。

---

## 10. 交互与输出规范

### 10.1 交互规范

- 对话区：作为主入口，支持连续多轮输入与状态反馈。
- 行程区：与对话区联动展示当前版本行程，按天支持展开查看时段活动详情。
- 编辑区：支持“自然语言连续修改 + Edit Day N”，并显示改动说明与差异摘要。
- 证据区：支持证据卡片展开、来源跳转、归因查看。

### 10.1.1 前端 UX 对齐 Agent 产品体验

交互体验对标 Mindtrip / ChatGPT / Perplexity 等主流 Agent 产品，具体规范：

**布局与导航**
- 桌面端采用双栏布局（Chat + Itinerary 同屏），窄屏降级为 Tab 切换。
- 输入栏（InputBar）始终可见，不随页面滚动消失。
- 重置 / 导出 / 滚动定位等快捷操作集成到 InputBar 或顶部 Nav。

**状态反馈**
- 所有 SSE 阶段（澄清/规划/校验/完成/错误）须有对应的视觉反馈，禁止"空白等待"。
- 规划等待期展示骨架屏或 shimmer 占位，减少用户感知延迟。
- 每轮编辑完成后，在对话区显示变更摘要卡片（DiffCard），包含本轮改动天数与预算差异。

**空态与异常**
- 首次进入 / 重置后展示引导态（EmptyState），包含示例输入与功能说明。
- 网络异常 / 超时 / 后端降级均展示 ErrorState，提供重试或重置入口。
- 用户始终有至少一个可操作入口，避免"死胡同"。

**体验精修（P1）**
- Chat 区系统回复支持流式逐字渲染。
- 行程区 slot 填充时使用渐显动画。
- 证据支持抽屉/面板展开，含来源跳转与归因展示。
- 预算可视化条展示分类占比与超限警告。
- 风险标签分级（高/中/低），hover 展开详情。
- 动效统一（150~300ms ease），避免装饰性动效干扰。

**响应式与无障碍**
- 三档断点：桌面（>= 1024px 双栏）、平板（768~1024px Tab）、移动（< 768px 单栏）。
- 核心交互键盘可操作（Tab/Enter/Esc），对比度 >= 4.5:1（AA 级）。

### 10.2 输出规范（产品契约）

最终结果需包含：
- 行程元信息：目的地、天数、预算口径、偏好约束
- 每日安排：早/中/晚时段及活动列表
- 预算分项：交通/住宿/门票/餐饮/other
- 风险与提醒：可执行性相关风险
- 备选方案：至少 1 组
- 证据引用：可追溯来源

推荐补充字段（MVP 建议）：
- `change_summary`：Edit Day N 后的变更摘要（只描述变化点）
- `budget_confidence`：预算估算置信等级（high/medium/low）
- `budget_assumptions`：预算依据说明（价格时间窗、是否含税、汇率基准）

---

## 11. 业务规则与边界

- 行程粒度：MVP 按“天+时段”，可选开始/结束时间字段，不强制填充。
- 币种规则：默认单币种展示，允许用户切换偏好币种。
- 预算规则：按五类分项统计并输出总预算。
- 可编辑规则：局部编辑应尽量保持全局一致性。
- 数据边界：MVP 以“规划与建议”为目标，不承诺交易可执行性。

### 11.1 最低必填约束（缺失即追问）

为平衡可用性与准确性，采用“硬门槛 + 软门槛”：

- 硬门槛（缺失即追问，未补齐不进入规划主链）：
  - 目的地（城市级）
  - 出行天数/日期范围
  - 总预算区间
- 软门槛（建议补充，缺失不阻断）：
  - 出行人群类型（独行/情侣/家庭/朋友）

若硬门槛缺失，系统必须先触发澄清提问；软门槛缺失可先生成草案，但需在输出中标注默认假设（assumptions）。

### 11.2 Edit Day N 稳定性规则

- 仅目标天允许大幅重排，非目标天应保持结构稳定。
- 非目标天变更比例应可计算并可展示（用于验收和调优）。
- 每次局部编辑必须输出 `change_summary`，说明：
  - 被替换活动
  - 新增活动
  - 受影响的通勤或预算变化

### 11.3 预算不确定性说明规则

- 所有预算为估算值，必须声明“非最终成交价”。
- 当价格来源不完整或时效性不足时，需降低 `budget_confidence`。
- 对关键预算项应标注依据（来源时间、币种、是否含税/服务费）。

### 11.4 风险提示分级规则

- 风险分为：高/中/低三级。
- 每版行程默认展示前 5 条最高优先级风险（避免信息过载）。
- 对高风险项必须给出可执行替代建议。

### 11.5 多方案比较触发规则

满足以下任一条件时触发多方案输出：
- 用户显式要求“对比/备选/Plan B”
- 当前方案超预算或约束冲突明显
- 系统识别到偏好冲突（如“低预算 + 高密度打卡”）

默认输出 2 组方案，按“平衡型/预算优先型”命名。

### 11.6 导出与保存（MVP 最低形态）

- 保存：支持将当前版本行程保存为会话内快照。
- 导出：支持文本导出（Markdown 或纯文本二选一）。
- 导出内容至少包含：每日安排、预算分项、风险提示、证据引用摘要。

---

## 12. 验收标准（Criteria）

### 12.1 体验验收

- 用户可在一次会话中完成“输入约束 -> 生成计划 -> 连续多轮编辑 -> 确认”闭环。
- 用户可在结果页快速定位每条推荐的证据来源。
- 局部编辑后，非目标天内容保持稳定。
- 当关键约束缺失时，系统先追问再生成。
- 导出/保存流程在 3 步内完成（可发现、可执行、可确认）。
- 桌面端可同屏查看对话与行程，窄屏可通过 Tab 切换，无布局溢出或重叠。
- SSE 所有阶段均有可见的 UI 反馈（无"空白等待"），包含空态引导与异常态兜底。
- 每轮编辑后对话区可见变更摘要卡片（DiffCard），用户无需手动对比前后版本。

### 12.2 质量验收

- 结构化输出可解析率达标（无关键字段缺失）。
- 约束满足率达标（预算、天数、偏好约束）。
- 工具调用可用率与降级可用率达标。
- 延迟与成本控制在目标范围内。
- Edit Day N 稳定性可量化：非目标天变更比例持续低于阈值。
- 对话连续编辑稳定性可量化：同会话 revision 链连续、差异回显正确、无上下文错乱。
- 风险提示满足分级与条数上限要求。

---

## 13. 里程碑（产品视角）

- M1：可生成可阅读的首版旅行计划（含基础证据）。
- M2：支持同一会话内连续编辑（create/edit/qa/reset）与差异回显。
- M3：增强证据质量、多方案比较与修订链体验（回看/回滚）。
- M4：稳定性优化与指标达标。

---

## 14. 风险与开放问题

### 14.1 已识别风险

- 外部信息质量波动导致证据不稳定。
- 局部编辑可能引发行程连锁冲突。
- 生成结果可读性与结构化一致性可能冲突。

### 14.2 待确认问题

- MVP 导出形式（仅页面保存，或包含下载能力）。
- 多方案比较在首版是否默认开启。
- 证据展示深度（摘要长度与信息密度平衡）。
