<template>
  <div class="ecommerce-container">
    <!-- å¤´éƒ¨å¯¼èˆªæ  -->
    <header class="header">
      <div class="top-bar">
        <div class="top-container">
          <div class="location">ä¸­å›½å¤§é™†ç‰ˆ Â· åŒ—äº¬</div>
          <div class="login-info">
            <span>æ‚¨å¥½ï¼Œ</span>
            <a href="#" class="login">è¯·ç™»å½•</a>
            <a href="#" class="register">å…è´¹æ³¨å†Œ</a>
          </div>
          <div class="top-nav">
            <a href="#" @click="backToMain">AIåŠ©æ‰‹</a>
            <a href="#">æˆ‘çš„è®¢å•</a>
            <a href="#">æˆ‘çš„è´­ç‰©è½¦ <span class="badge">1</span></a>
            <a href="#">å•†å®¶æœåŠ¡</a>
            <a href="#">ç½‘ç«™å¯¼èˆª</a>
          </div>
        </div>
      </div>
      <div class="header-main-container">
        <div class="main-header">
          <div class="logo" @click="backToMain">
            <div class="logo-box">å±…å±…</div>
          </div>
          <div class="search-box">
            <input type="text" placeholder="å°ç™½ç†Šæ’æ¸©è°ƒå¥¶å™¨" v-model="searchInput"/>
            <button class="search-btn">æœç´¢</button>
          </div>
          <div class="cart">
            <div class="cart-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M9 22C9.55228 22 10 21.5523 10 21C10 20.4477 9.55228 20 9 20C8.44772 20 8 20.4477 8 21C8 21.5523 8.44772 22 9 22Z" stroke="black" stroke-width="2"/>
                <path d="M20 22C20.5523 22 21 21.5523 21 21C21 20.4477 20.5523 20 20 20C19.4477 20 19 20.4477 19 21C19 21.5523 19.4477 22 20 22Z" stroke="black" stroke-width="2"/>
                <path d="M1 1H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19.4C19.8693 16.009 20.3268 15.8526 20.6925 15.5583C21.0581 15.264 21.3086 14.8504 21.4 14.39L23 6H6" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span class="cart-count">1</span>
            </div>
            <span>è´­ç‰©è½¦</span>
          </div>
        </div>
      </div>
      <div class="nav-wrapper">
        <div class="nav-container">
          <div class="nav-menu">
            <div class="categories">
              <span>å…¨éƒ¨å•†å“åˆ†ç±»</span>
            </div>
            <ul class="menu-items">
              <li><a href="#">é¦–é¡µ</a></li>
              <li><a href="#">çƒ­é”€å•†å“</a></li>
              <li><a href="#">æ–°å“ä¸Šå¸‚</a></li>
              <li><a href="#">ä¼˜æƒ æ´»åŠ¨</a></li>
              <li><a href="#">å“ç‰Œä¸“åŒº</a></li>
              <li><a href="#">å®¢æœä¸­å¿ƒ</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="quick-links">
        <div class="quick-links-container">
          <ul class="links-list">
            <li><a href="#">å‡ºå£è½¬å†…é”€åˆå¥½åˆä¾¿å®œ</a></li>
            <li><a href="#">å¾—åŠ›åŠå…¬çº¦100ä»¶å¥½ç‰©</a></li>
            <li><a href="#">æˆ·å¤–é‹æœé¦†</a></li>
            <li><a href="#">é£æ‰‡ç©ºè°ƒ</a></li>
            <li><a href="#">å†²é”‹è¡£</a></li>
            <li><a href="#">é»„é‡‘é¡¹é“¾</a></li>
            <li><a href="#">å°ç‹—KP</a></li>
            <li><a href="#">è·‘æ­¥æœº</a></li>
            <li><a href="#">æ™ºèƒ½æ‰‹è¡¨</a></li>
          </ul>
        </div>
      </div>
    </header>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
      <!-- å·¦ä¾§åˆ†ç±»å¯¼èˆª -->
      <div class="sidebar">
        <ul class="category-list">
          <li><i class="icon">ğŸ“±</i> æ‰‹æœº/è¿è¥å•†/æ•°ç </li>
          <li><i class="icon">ğŸ’»</i> ç”µè„‘/åŠå…¬</li>
          <li><i class="icon">ğŸ </i> å®¶å±…/å®¶å…·/å®¶è£…/å¨å…·</li>
          <li><i class="icon">ğŸ‘•</i> ç”·è£…/å¥³è£…/ç«¥è£…/å†…è¡£</li>
          <li><i class="icon">ğŸ‘Ÿ</i> ç¾å¦†/ä¸ªæŠ¤æ¸…æ´/å® ç‰©</li>
          <li><i class="icon">ğŸ’</i> å¥³é‹/ç®±åŒ…/é’Ÿè¡¨/ç å®</li>
          <li><i class="icon">ğŸƒ</i> ç”·é‹/è¿åŠ¨/æˆ·å¤–</li>
          <li><i class="icon">ğŸš—</i> æ±½è½¦/æ±½è½¦ç”¨å“</li>
          <li><i class="icon">ğŸ‘¶</i> æ¯å©´/ç©å…·ä¹å™¨</li>
          <li><i class="icon">ğŸš</i> é£Ÿå“/é…’ç±»/ç”Ÿé²œ/ç‰¹äº§</li>
        </ul>
      </div>

      <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
      <div class="content">
        <!-- BanneråŒºåŸŸ -->
        <div class="banner-area" style="display: none;">
          <div class="main-banner">
            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MDAiIGhlaWdodD0iMzAwIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNmZmVlZWUiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNkZGVmYmIiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iNzAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0idXJsKCNncmFkKSIvPjx0ZXh0IHg9IjM1MCIgeT0iMTUwIiBmb250LXNpemU9IjMwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjNjY2Ij7lpJrku7flk4jotKjkuK3lv4M8L3RleHQ+PC9zdmc+" alt="Banner" />
          </div>
        </div>
        
        <!-- å°banneråŒºåŸŸ -->
        <div class="side-banners-container" style="display: none;">
          <div class="side-banner">
            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMjAiIGhlaWdodD0iMTQ1Ij48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNlMGVhZmMiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNjZmRlZjMiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iMjIwIiBoZWlnaHQ9IjE0NSIgZmlsbD0idXJsKCNncmFkKSIvPjx0ZXh0IHg9IjExMCIgeT0iNzAiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiM2NjYiPuWNleWTgeS8mOWMljwvdGV4dD48L3N2Zz4=" alt="Side Banner 1" />
          </div>
          <div class="side-banner">
            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMjAiIGhlaWdodD0iMTQ1Ij48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNmZmQxZDEiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNmZmE4YTgiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iMjIwIiBoZWlnaHQ9IjE0NSIgZmlsbD0idXJsKCNncmFkKSIvPjx0ZXh0IHg9IjExMCIgeT0iNzAiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiM2NjYiPuS6keWNleS8mOaDoOa0vjwvdGV4dD48L3N2Zz4=" alt="Side Banner 2" />
          </div>
        </div>

        <!-- æ¨èå•†å“åŒºåŸŸ -->
        <div class="recommended-products">
          <div class="section-header">
            <h2>ä¸ºæ‚¨æ¨è</h2>
            <a href="#" class="more-link">æ›´å¤šå¥½è´§ ></a>
          </div>
          <div class="product-list">
            <div class="product-card" v-for="(product, index) in recommendedProducts" :key="index">
              <div class="product-image" :data-name="product.name">
                <img :src="product.image" :alt="product.name" />
              </div>
              <div class="product-info">
                <h3 class="product-name">{{ product.name }}</h3>
                <p class="product-desc">{{ product.description }}</p>
                <div class="product-price">Â¥{{ product.price }}</div>
                <button class="add-to-cart-btn">åŠ å…¥è´­ç‰©è½¦</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- çƒ­é”€å•†å“åŒºåŸŸ -->
        <div class="hot-products">
          <div class="section-header">
            <h2>çƒ­é”€å•†å“</h2>
            <a href="#" class="more-link">æ›´å¤šçƒ­å– ></a>
          </div>
          <div class="product-list">
            <div class="product-card" v-for="(product, index) in hotProducts" :key="index">
              <div class="product-image" :data-name="product.name">
                <img :src="product.image" :alt="product.name" />
              </div>
              <div class="product-info">
                <h3 class="product-name">{{ product.name }}</h3>
                <p class="product-desc">{{ product.description }}</p>
                <div class="product-price">Â¥{{ product.price }}</div>
                <button class="add-to-cart-btn">åŠ å…¥è´­ç‰©è½¦</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- å®¢æœæµ®åŠ¨æŒ‰é’® -->
    <div class="chat-float-btn" @click="toggleChatPopup">
      <div class="chat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M21 11.5C21.0034 12.8199 20.6951 14.1219 20.1 15.3C19.3944 16.7118 18.3098 17.8992 16.9674 18.7293C15.6251 19.5594 14.0782 19.9994 12.5 20C11.1801 20.0035 9.87812 19.6951 8.7 19.1L3 21L4.9 15.3C4.30493 14.1219 3.99656 12.8199 4 11.5C4.00061 9.92179 4.44061 8.37488 5.27072 7.03258C6.10083 5.69028 7.28825 4.6056 8.7 3.90003C9.87812 3.30496 11.1801 2.99659 12.5 3.00003H13C15.0843 3.11502 17.053 3.99479 18.5291 5.47089C20.0052 6.94699 20.885 8.91568 21 11V11.5Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <span>è”ç³»å®¢æœ</span>
    </div>

    <!-- èŠå¤©å¼¹çª— -->
    <div class="chat-popup" v-if="showChatPopup">
      <div class="chat-popup-header">
        <h3>åœ¨çº¿å®¢æœ</h3>
        <button class="close-btn" @click="showChatPopup = false">Ã—</button>
      </div>
      <div class="chat-popup-messages" ref="messagesContainer">
        <div v-for="(message, index) in messages" 
             :key="index"
             :class="['popup-message', message.role === 'user' ? 'popup-user-message' : 'popup-assistant-message']">
          <!-- å¦‚æœæœ‰å›¾ç‰‡ï¼Œæ˜¾ç¤ºå›¾ç‰‡ -->
          <div v-if="message.imageUrl" class="message-image">
            <img :src="message.imageUrl" alt="ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡" />
          </div>
          <!-- æ˜¾ç¤ºæ–‡æœ¬å†…å®¹ -->
          <div class="popup-message-content" v-html="renderMessage(message.content)"></div>
        </div>
      </div>
      <div class="chat-popup-input">
        <input 
          type="text" 
          v-model="userInput" 
          @keyup.enter="sendMessage"
          placeholder="è¯·è¾“å…¥æ‚¨æƒ³å’¨è¯¢çš„é—®é¢˜..."
        />
        <label class="upload-btn">
          <input type="file" accept="image/*" @change="handleImageUpload" ref="fileInput" style="display:none" />
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 16L8.586 11.414C8.96106 11.0391 9.46967 10.8284 10 10.8284C10.5303 10.8284 11.0389 11.0391 11.414 11.414L16 16M14 14L15.586 12.414C15.9611 12.0391 16.4697 11.8284 17 11.8284C17.5303 11.8284 18.0389 12.0391 18.414 12.414L20 14M14 8H14.01M6 20H18C18.5304 20 19.0391 19.7893 19.4142 19.4142C19.7893 19.0391 20 18.5304 20 18V6C20 5.46957 19.7893 4.96086 19.4142 4.58579C19.0391 4.21071 18.5304 4 18 4H6C5.46957 4 4.96086 4.21071 4.58579 4.58579C4.21071 4.96086 4 5.46957 4 6V18C4 18.5304 4.21071 19.0391 4.58579 19.4142C4.96086 19.7893 5.46957 20 6 20Z" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </label>
        <button class="send-btn" @click="sendMessage">å‘é€</button>
      </div>
    </div>

    <!-- åº•éƒ¨åŒºåŸŸ -->
    <footer class="footer">
      <div class="footer-links">
        <div class="link-group">
          <h3>è´­ç‰©æŒ‡å—</h3>
          <ul>
            <li><a href="#">è´­ç‰©æµç¨‹</a></li>
            <li><a href="#">ä¼šå‘˜ä»‹ç»</a></li>
            <li><a href="#">ç”Ÿæ´»æ—…è¡Œ</a></li>
            <li><a href="#">å¸¸è§é—®é¢˜</a></li>
          </ul>
        </div>
        <div class="link-group">
          <h3>é…é€æ–¹å¼</h3>
          <ul>
            <li><a href="#">ä¸Šé—¨è‡ªæ</a></li>
            <li><a href="#">211é™æ—¶è¾¾</a></li>
            <li><a href="#">é…é€æœåŠ¡æŸ¥è¯¢</a></li>
            <li><a href="#">é…é€è´¹æ”¶å–æ ‡å‡†</a></li>
          </ul>
        </div>
        <div class="link-group">
          <h3>æ”¯ä»˜æ–¹å¼</h3>
          <ul>
            <li><a href="#">è´§åˆ°ä»˜æ¬¾</a></li>
            <li><a href="#">åœ¨çº¿æ”¯ä»˜</a></li>
            <li><a href="#">åˆ†æœŸä»˜æ¬¾</a></li>
            <li><a href="#">å…¬å¸è½¬è´¦</a></li>
          </ul>
        </div>
        <div class="link-group">
          <h3>å”®åæœåŠ¡</h3>
          <ul>
            <li><a href="#">å”®åæ”¿ç­–</a></li>
            <li><a href="#">ä»·æ ¼ä¿æŠ¤</a></li>
            <li><a href="#">é€€æ¬¾è¯´æ˜</a></li>
            <li><a href="#">è¿”ä¿®/é€€æ¢è´§</a></li>
          </ul>
        </div>
      </div>
      <div class="copyright">
        Copyright Â© 2023 AIç”µå•†å®¢æœ. All Rights Reserved.
      </div>
    </footer>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, nextTick } from 'vue'
import { useRouter } from 'vue-router'
import MarkdownIt from 'markdown-it'
import axios from 'axios'

const router = useRouter()
const md = new MarkdownIt()
const messagesContainer = ref<HTMLElement | null>(null)
const userInput = ref('')
const searchInput = ref('')
const showChatPopup = ref(false)
const fileInput = ref<HTMLInputElement | null>(null)
const isUploading = ref(false)
const conversationId = ref<string | null>(null)

// æ¶ˆæ¯åˆ—è¡¨
const messages = ref<{ role: 'user' | 'assistant', content: string, isLoading?: boolean, imageUrl?: string }[]>([
  {
    role: 'assistant',
    content: 'æ‚¨å¥½ï¼æˆ‘æ˜¯æ™ºèƒ½å®¢æœåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿ ğŸ˜Š'
  }
])

// æ¨èå•†å“
const recommendedProducts = ref([
  {
    name: 'Anker 20000mAh ç§»åŠ¨ç”µæº',
    description: 'å¤§å®¹é‡å¿«å……ï¼ŒåŒå‘å……ç”µï¼Œé€‚ç”¨äºiPhoneã€iPadã€å®‰å“è®¾å¤‡',
    price: 159.00,
    image: 'data:image/svg+xml;charset=utf8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22 viewBox=%220 0 200 200%22%3E%3Crect width=%22200%22 height=%22200%22 fill=%22%23f0f0f0%22/%3E%3Cpath d=%22M50 70h100v60H50z%22 fill=%22%23FF4D4F%22 opacity=%220.8%22/%3E%3Cpath d=%22M60 80h80v40H60z%22 fill=%22%23FFF%22/%3E%3Ccircle cx=%2270%22 cy=%22100%22 r=%225%22 fill=%22%23FF4D4F%22/%3E%3Ccircle cx=%2285%22 cy=%22100%22 r=%225%22 fill=%22%23FF4D4F%22/%3E%3C/svg%3E'
  },
  {
    name: 'å°ç±³ 11 Ultra 5Gæ‰‹æœº',
    description: 'éªé¾™888å¤„ç†å™¨ï¼Œ120Hzé«˜åˆ·æ–°ç‡ï¼Œ67Wå¿«å……',
    price: 5499.00,
    image: 'data:image/svg+xml;charset=utf8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22 viewBox=%220 0 200 200%22%3E%3Crect width=%22200%22 height=%22200%22 fill=%22%23f0f0f0%22/%3E%3Crect x=%2270%22 y=%2250%22 width=%2260%22 height=%22100%22 rx=%225%22 fill=%22%23FF4D4F%22 opacity=%220.7%22/%3E%3Crect x=%2275%22 y=%2255%22 width=%2250%22 height=%2280%22 rx=%222%22 fill=%22white%22/%3E%3Ccircle cx=%22100%22 cy=%22145%22 r=%225%22 fill=%22%23555%22/%3E%3C/svg%3E'
  },
  {
    name: 'Apple AirPods Pro',
    description: 'ä¸»åŠ¨é™å™ªï¼Œç©ºé—´éŸ³é¢‘ï¼Œå…¥è€³æ£€æµ‹ï¼ŒIPX4é˜²æ°´',
    price: 1999.00,
    image: 'data:image/svg+xml;charset=utf8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22 viewBox=%220 0 200 200%22%3E%3Crect width=%22200%22 height=%22200%22 fill=%22%23f0f0f0%22/%3E%3Cpath d=%22M70 60C70 60 80 70 80 90C80 100 77 105 75 110C73 115 70 120 60 120C50 120 47 115 45 110C43 105 40 100 40 90C40 70 50 60 50 60%22 fill=%22white%22 stroke=%22%23555%22 stroke-width=%223%22/%3E%3Cpath d=%22M150 60C150 60 140 70 140 90C140 100 143 105 145 110C147 115 150 120 160 120C170 120 173 115 175 110C177 105 180 100 180 90C180 70 170 60 170 60%22 fill=%22white%22 stroke=%22%23555%22 stroke-width=%223%22/%3E%3Cpath d=%22M110 130L90 120%22 stroke=%22%23555%22 stroke-width=%223%22/%3E%3Cpath d=%22M110 130L130 120%22 stroke=%22%23555%22 stroke-width=%223%22/%3E%3Ccircle cx=%22110%22 cy=%22130%22 r=%2210%22 fill=%22%23555%22/%3E%3C/svg%3E'
  },
  {
    name: 'åä¸º MateBook 14',
    description: '11ä»£é…·ç¿i7ï¼Œ16GBå†…å­˜ï¼Œ512GBå›ºæ€ç¡¬ç›˜',
    price: 6299.00,
    image: 'data:image/svg+xml;charset=utf8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22 viewBox=%220 0 200 200%22%3E%3Crect width=%22200%22 height=%22200%22 fill=%22%23f0f0f0%22/%3E%3Cpath d=%22M40 70h120v60H40z%22 fill=%22%23333%22/%3E%3Cpath d=%22M40 130h120v10H40z%22 fill=%22%23555%22/%3E%3Ccircle cx=%22100%22 cy=%22135%22 r=%222%22 fill=%22%23fff%22/%3E%3C/svg%3E'
  }
])

// çƒ­é”€å•†å“
const hotProducts = ref([
  {
    name: 'å°ç±³æ™ºèƒ½æ‰‹ç¯6',
    description: '1.56è‹±å¯¸AMOLEDå¤§å±ï¼Œè¡€æ°§ç›‘æµ‹ï¼Œ14å¤©è¶…é•¿ç»­èˆª',
    price: 249.00,
    image: 'data:image/svg+xml;charset=utf8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22 viewBox=%220 0 200 200%22%3E%3Crect width=%22200%22 height=%22200%22 fill=%22%23f0f0f0%22/%3E%3Crect x=%2280%22 y=%2260%22 width=%2240%22 height=%2280%22 rx=%2220%22 fill=%22%23FF4D4F%22 opacity=%220.8%22/%3E%3Crect x=%2285%22 y=%2265%22 width=%2230%22 height=%2270%22 rx=%225%22 fill=%22white%22/%3E%3C/svg%3E'
  },
  {
    name: 'è£è€€50 Pro',
    description: 'éªé¾™778Gï¼Œ100Wè¶…çº§å¿«å……ï¼Œ1äº¿åƒç´ è¶…æ¸…å½±åƒ',
    price: 2999.00,
    image: 'data:image/svg+xml;charset=utf8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22 viewBox=%220 0 200 200%22%3E%3Crect width=%22200%22 height=%22200%22 fill=%22%23f0f0f0%22/%3E%3Crect x=%2265%22 y=%2245%22 width=%2270%22 height=%22110%22 rx=%228%22 fill=%22%23FF8800%22 opacity=%220.8%22/%3E%3Crect x=%2270%22 y=%2250%22 width=%2260%22 height=%2290%22 rx=%224%22 fill=%22white%22/%3E%3Ccircle cx=%22100%22 cy=%22150%22 r=%224%22 fill=%22%23333%22/%3E%3Ccircle cx=%2285%22 cy=%2260%22 r=%223%22 fill=%22%23333%22/%3E%3Ccircle cx=%22100%22 cy=%2260%22 r=%223%22 fill=%22%23333%22/%3E%3Ccircle cx=%22115%22 cy=%2260%22 r=%223%22 fill=%22%23333%22/%3E%3C/svg%3E'
  },
  {
    name: 'OPPO Reno6',
    description: 'å¤©ç‘900ï¼Œ65Wè¶…çº§é—ªå……ï¼ŒAIäººåƒè§†é¢‘',
    price: 2799.00,
    image: 'data:image/svg+xml;charset=utf8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22 viewBox=%220 0 200 200%22%3E%3Crect width=%22200%22 height=%22200%22 fill=%22%23f0f0f0%22/%3E%3Crect x=%2265%22 y=%2250%22 width=%2270%22 height=%22110%22 rx=%226%22 fill=%22%2300A0E9%22 opacity=%220.8%22/%3E%3Crect x=%2270%22 y=%2255%22 width=%2260%22 height=%2290%22 rx=%224%22 fill=%22white%22/%3E%3Ccircle cx=%22100%22 cy=%22150%22 r=%224%22 fill=%22%2300A0E9%22/%3E%3Ccircle cx=%2285%22 cy=%2265%22 r=%224%22 fill=%22%2300A0E9%22/%3E%3Ccircle cx=%22100%22 cy=%2265%22 r=%224%22 fill=%22%2300A0E9%22/%3E%3C/svg%3E'
  },
  {
    name: 'ç½—æŠ€ MX Master 3é¼ æ ‡',
    description: 'é«˜ç²¾åº¦ä¼ æ„Ÿå™¨ï¼Œå®šåˆ¶æŒ‰é”®ï¼Œå¤šè®¾å¤‡æ§åˆ¶',
    price: 699.00,
    image: 'data:image/svg+xml;charset=utf8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22 viewBox=%220 0 200 200%22%3E%3Crect width=%22200%22 height=%22200%22 fill=%22%23f0f0f0%22/%3E%3Cpath d=%22M60 80C60 60 80 60 100 60C120 60 140 60 140 80C140 100 140 120 100 120C60 120 60 100 60 80Z%22 fill=%22%23444%22/%3E%3Cpath d=%22M95 60C95 60 100 50 105 60%22 stroke=%22%23444%22 stroke-width=%222%22/%3E%3Ccircle cx=%22100%22 cy=%2270%22 r=%222%22 fill=%22%23ccc%22/%3E%3Cpath d=%22M100 75L100 90%22 stroke=%22%23ccc%22 stroke-width=%221%22/%3E%3C/svg%3E'
  }
])

// è¿”å›ä¸»é¡µ
const backToMain = () => {
  router.push('/')
}

// åˆ‡æ¢èŠå¤©å¼¹çª—æ˜¾ç¤º
const toggleChatPopup = () => {
  showChatPopup.value = !showChatPopup.value
  
  if (showChatPopup.value) {
    // å¦‚æœæ˜¯æ–°æ‰“å¼€çš„èŠå¤©çª—å£ï¼Œé‡ç½®ä¼šè¯ID
    if (conversationId.value === null) {
      conversationId.value = 'ecommerce_' + Date.now().toString();
    }
    
    nextTick(() => {
      scrollToBottom()
    })
  }
}

// å‘é€æ¶ˆæ¯
const sendMessage = async () => {
  if (!userInput.value.trim()) return
  
  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
  messages.value.push({
    role: 'user',
    content: userInput.value
  })
  
  const userQuestion = userInput.value
  userInput.value = ''
  
  // æ»šåŠ¨åˆ°åº•éƒ¨
  await nextTick()
  scrollToBottom()
  
  try {
    // è·å–ç”¨æˆ·ID
    const userId = localStorage.getItem('user_id')
    if (!userId) {
      throw new Error('ç”¨æˆ·IDä¸å­˜åœ¨')
    }
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    messages.value.push({
      role: 'assistant',
      content: 'æ­£åœ¨æ€è€ƒ...',
      isLoading: true
    })
    
    // åˆ›å»ºFormData
    const formData = new FormData()
    formData.append('query', userQuestion)
    formData.append('user_id', userId)
    
    // æ·»åŠ ä¼šè¯ID
    if (conversationId.value) {
      formData.append('conversation_id', conversationId.value)
    }
    
    // è°ƒç”¨API
    const response = await fetch('http://localhost:8000/api/langgraph/query', {
      method: 'POST',
      body: formData
    })
    
    if (!response.ok) {
      throw new Error(`è¯·æ±‚å¤±è´¥: ${response.status}`)
    }
    
    // å­˜å‚¨è¿”å›çš„ä¼šè¯IDï¼ˆå¦‚æœæœ‰ï¼‰
    const returnedConversationId = response.headers.get('X-Conversation-ID')
    if (returnedConversationId) {
      conversationId.value = returnedConversationId
    }
    
    // ç§»é™¤åŠ è½½æ¶ˆæ¯
    const loadingMsgIndex = messages.value.findIndex(msg => msg.isLoading)
    if (loadingMsgIndex !== -1) {
      messages.value.splice(loadingMsgIndex, 1)
    }
    
    // æ£€æŸ¥å“åº”ç±»å‹
    const contentType = response.headers.get('Content-Type')
    
    // å¦‚æœæ˜¯æµå¼å“åº”
    if (contentType && contentType.includes('text/event-stream')) {
      // æ·»åŠ ä¸€ä¸ªç©ºçš„åŠ©æ‰‹æ¶ˆæ¯
      messages.value.push({
        role: 'assistant',
        content: ''
      })
      
      // è·å–reader
      const reader = response.body?.getReader()
      if (!reader) throw new Error('æ— æ³•è¯»å–å“åº”æµ')
      
      // å¤„ç†æµ
      await handleChatStream(reader)
    } else {
      // éæµå¼å“åº”ï¼Œå¤„ç†JSON
      const result = await response.json()
      messages.value.push({
        role: 'assistant',
        content: result.response || 'æŠ±æ­‰ï¼Œæˆ‘æ— æ³•å¤„ç†æ‚¨çš„è¯·æ±‚ã€‚'
      })
    }
  } catch (error) {
    console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error)
    
    // ç§»é™¤åŠ è½½æ¶ˆæ¯
    const loadingMsgIndex = messages.value.findIndex(msg => msg.isLoading)
    if (loadingMsgIndex !== -1) {
      messages.value.splice(loadingMsgIndex, 1)
    }
    
    // æ·»åŠ é”™è¯¯æç¤º
    messages.value.push({
      role: 'assistant',
      content: 'æŠ±æ­‰ï¼Œå‘ç”Ÿäº†é”™è¯¯ï¼Œè¯·ç¨åå†è¯•ã€‚'
    })
  }
}

// å¤„ç†èŠå¤©æµ
const handleChatStream = async (reader: ReadableStreamDefaultReader<Uint8Array>) => {
  const decoder = new TextDecoder()
  let currentContent = ''
  
  try {
    while (true) {
      const { done, value } = await reader.read()
      if (done) break
  
      const chunk = decoder.decode(value)
      const lines = chunk.split('\n')
      
      for (const line of lines) {
        if (!line.startsWith('data: ')) continue
        
        const content = line.slice(6) // ç§»é™¤ 'data: ' å‰ç¼€
        if (content === '[DONE]') continue
        
        // å¤„ç†æ‰€æœ‰å¯èƒ½çš„æ¢è¡Œç¬¦å½¢å¼
        if (content === '"\\n\\n"' || content === '"\n\n"' || content === '\n\n') {
          currentContent += '\n\n'
          continue
        }
        
        // ç§»é™¤å¼•å·
        let cleanedContent = content
        if (cleanedContent.startsWith('"') && cleanedContent.endsWith('"')) {
          cleanedContent = cleanedContent.slice(1, -1)
        }
        
        // å¤„ç†è½¬ä¹‰çš„æ¢è¡Œç¬¦
        cleanedContent = cleanedContent.replace(/\\n\\n/g, '\n\n').replace(/\\n/g, '\n')
  
        // æ·»åŠ åˆ°å½“å‰å†…å®¹
        currentContent += cleanedContent
        
        // æ›´æ–°æœ€åä¸€æ¡æ¶ˆæ¯çš„å†…å®¹
        const lastMessage = messages.value[messages.value.length - 1]
        lastMessage.content = currentContent
        
        // æ»šåŠ¨åˆ°åº•éƒ¨
        await nextTick()
        scrollToBottom()
      }
    }
  } catch (error) {
    console.error('Error handling chat stream:', error)
    const lastMessage = messages.value[messages.value.length - 1]
    lastMessage.content = 'æŠ±æ­‰ï¼Œå‘ç”Ÿäº†é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚'
  }
}

// æ¸²æŸ“æ¶ˆæ¯å†…å®¹
const renderMessage = (content: string) => {
  // ä½¿ç”¨æ— ç©ºè¡Œçš„Markdowné…ç½®
  const customMd = new MarkdownIt({
    breaks: true,
    html: false,
    linkify: true,
  })
  
  // å¤„ç†æ®µè½æ ‡ç­¾ï¼Œå»æ‰é¢å¤–ç©ºç™½
  const html = customMd.render(content)
  return html.replace(/<p>(.*?)<\/p>/g, '$1').replace(/<br><br>/g, '<br>')
}

// æ»šåŠ¨åˆ°åº•éƒ¨
const scrollToBottom = () => {
  if (messagesContainer.value) {
    messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight
  }
}

// å¤„ç†å›¾ç‰‡ä¸Šä¼ 
const handleImageUpload = async (event: Event) => {
  const target = event.target as HTMLInputElement
  if (!target || !target.files || target.files.length === 0) return

  const file = target.files[0]
  if (!file) return

  try {
    // è·å–ç”¨æˆ·ID
    const userId = localStorage.getItem('user_id')
    if (!userId) {
      throw new Error('ç”¨æˆ·IDä¸å­˜åœ¨')
    }

    // æ˜¾ç¤ºä¸Šä¼ ä¸­çŠ¶æ€
    isUploading.value = true

    // æ·»åŠ å›¾ç‰‡æ¶ˆæ¯åˆ°èŠå¤©
    messages.value.push({
      role: 'user',
      content: '[ä¸Šä¼ å›¾ç‰‡ä¸­...]',
      isLoading: true
    })

    // ç›´æ¥å‘é€å›¾ç‰‡åˆ°langgraph API
    const formData = new FormData()
    formData.append('query', 'ç”¨æˆ·ä¸Šä¼ äº†å›¾ç‰‡ï¼Œéœ€è¦è°ƒç”¨è§†è§‰æ¨¡å‹è¿›è¡Œåˆ†æ')
    formData.append('user_id', userId)
    formData.append('image', file)
    
    // æ·»åŠ ä¼šè¯ID
    if (conversationId.value) {
      formData.append('conversation_id', conversationId.value)
    }

    // è°ƒç”¨API
    const response = await fetch('http://localhost:8000/api/langgraph/query', {
      method: 'POST',
      body: formData
    })

    if (!response.ok) {
      throw new Error(`è¯·æ±‚å¤±è´¥: ${response.status}`)
    }
    
    // å­˜å‚¨è¿”å›çš„ä¼šè¯IDï¼ˆå¦‚æœæœ‰ï¼‰
    const returnedConversationId = response.headers.get('X-Conversation-ID')
    if (returnedConversationId) {
      conversationId.value = returnedConversationId
    }
    
    // æ›´æ–°æ¶ˆæ¯çŠ¶æ€
    const loadingMsgIndex = messages.value.findIndex(msg => msg.isLoading)
    if (loadingMsgIndex !== -1) {
      messages.value[loadingMsgIndex] = {
        role: 'user',
        content: '',
        imageUrl: URL.createObjectURL(file)
      }
    }

    // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
    if (fileInput.value) {
      fileInput.value.value = ''
    }

    // æ£€æŸ¥å“åº”ç±»å‹
    const contentType = response.headers.get('Content-Type')
    
    // å¦‚æœæ˜¯æµå¼å“åº”
    if (contentType && contentType.includes('text/event-stream')) {
      // æ·»åŠ ä¸€ä¸ªç©ºçš„åŠ©æ‰‹æ¶ˆæ¯
      messages.value.push({
        role: 'assistant',
        content: ''
      })
      
      // è·å–reader
      const reader = response.body?.getReader()
      if (!reader) throw new Error('æ— æ³•è¯»å–å“åº”æµ')
      
      // å¤„ç†æµ
      await handleChatStream(reader)
    } else {
      // éæµå¼å“åº”ï¼Œå¤„ç†JSON
      const result = await response.json()
      messages.value.push({
        role: 'assistant',
        content: result.response || 'æŠ±æ­‰ï¼Œæˆ‘æ— æ³•åˆ†æè¿™å¼ å›¾ç‰‡ã€‚'
      })
    }

  } catch (error) {
    console.error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥:', error)
    
    // æ›´æ–°æˆ–ç§»é™¤åŠ è½½æ¶ˆæ¯
    const loadingMsgIndex = messages.value.findIndex(msg => msg.isLoading)
    if (loadingMsgIndex !== -1) {
      messages.value.splice(loadingMsgIndex, 1)
    }
    
    // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
    messages.value.push({
      role: 'assistant',
      content: 'æŠ±æ­‰ï¼Œå›¾ç‰‡ä¸Šä¼ æˆ–åˆ†æå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚'
    })
  } finally {
    isUploading.value = false
  }
}

onMounted(() => {
  scrollToBottom()
})
</script>

<style scoped>
.ecommerce-container {
  width: 100%;
  min-height: 100vh;
  background-color: #f5f5f5;
  font-family: Arial, sans-serif;
  color: #333;
}

/* å¤´éƒ¨æ ·å¼ */
.header {
  width: 100%;
  background-color: #fff;
}

.top-bar {
  height: 30px;
  background-color: #e3e4e5;
  display: flex;
  align-items: center;
  padding: 0;
  color: #999;
  font-size: 12px;
}

.top-container {
  display: flex;
  align-items: center;
  width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

.location {
  margin-right: 20px;
}

.login-info {
  margin-right: auto;
}

.login-info a {
  color: #ff4d4f;
  margin: 0 5px;
  text-decoration: none;
}

.top-nav {
  display: flex;
}

.top-nav a {
  color: #999;
  margin-left: 15px;
  text-decoration: none;
}

.top-nav a:hover {
  color: #ff4d4f;
}

.badge {
  background-color: #ff4d4f;
  color: white;
  border-radius: 50%;
  font-size: 10px;
  padding: 1px 4px;
}

.header-main-container {
  padding: 0;
  border-bottom: 1px solid #eee;
}

.main-header {
  height: 100px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

.logo {
  margin-right: 40px;
  cursor: pointer;
}

.logo-box {
  width: 120px;
  height: 40px;
  background-color: #ff4d4f;
  color: white;
  font-size: 24px;
  font-weight: bold;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.search-box {
  flex: 1;
  max-width: 600px;
  height: 36px;
  display: flex;
  margin-right: 40px;
}

.search-box input {
  flex: 1;
  height: 100%;
  padding: 0 15px;
  border: 2px solid #ff4d4f;
  border-right: none;
  border-top-left-radius: 20px;
  border-bottom-left-radius: 20px;
  font-size: 14px;
  outline: none;
}

.search-btn {
  width: 80px;
  height: 100%;
  background-color: #ff4d4f;
  color: white;
  border: none;
  border-top-right-radius: 20px;
  border-bottom-right-radius: 20px;
  font-size: 16px;
  cursor: pointer;
}

.cart {
  display: flex;
  align-items: center;
  color: #333;
  font-size: 14px;
}

.cart-icon {
  position: relative;
  margin-right: 8px;
}

.cart-icon svg path {
  stroke: #333;
}

.cart-count {
  position: absolute;
  top: -5px;
  right: -5px;
  background-color: #ff4d4f;
  color: white;
  font-size: 10px;
  width: 15px;
  height: 15px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.nav-wrapper {
  background-color: #ff4d4f;
  width: 100%;
}

.nav-container {
  width: 1200px;
  margin: 0 auto;
}

.nav-menu {
  display: flex;
  height: 40px;
}

.categories {
  width: 180px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #d23c3e;
  color: white;
  font-weight: bold;
  font-size: 14px;
  cursor: pointer;
}

.menu-items {
  flex: 1;
  display: flex;
  list-style: none;
  margin: 0;
  padding: 0;
}

.menu-items li {
  margin: 0;
  line-height: 40px;
  padding: 0 15px;
}

.menu-items a {
  color: white;
  text-decoration: none;
  font-size: 14px;
  font-weight: normal;
}

.menu-items a:hover {
  color: #fff;
  opacity: 0.8;
}

/* ä¸»å†…å®¹åŒºåŸŸæ ·å¼ */
.main-content {
  display: flex;
  padding: 0;
  width: 1200px;
  margin: 0 auto;
}

.sidebar {
  width: 200px;
  background-color: #fff;
  border-radius: 4px;
  overflow: hidden;
  margin-right: 10px;
}

.category-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.category-list li {
  padding: 10px 15px;
  border-bottom: 1px solid #eee;
  cursor: pointer;
  font-size: 14px;
  display: flex;
  align-items: center;
}

.category-list li:hover {
  background-color: #f5f5f5;
  color: #ff4d4f;
}

.icon {
  margin-right: 10px;
}

.content {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.banner-area {
  display: none;
  width: 100%;
  margin-bottom: 20px;
}

.main-banner {
  width: 100%;
  height: 300px;
  background: linear-gradient(135deg, #ffeeee 0%, #ddefbb 100%);
  border-radius: 8px;
  overflow: hidden;
}

.main-banner img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.side-banners-container {
  display: none;
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
}

.side-banner {
  flex: 1;
  height: 145px;
  background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
  border-radius: 8px;
  overflow: hidden;
  transition: all 0.3s ease;
}

.side-banner:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.side-banner img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* æ¨èå•†å“åŒºåŸŸæ ·å¼ */
.recommended-products {
  background-color: #fff;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.section-header h2 {
  font-size: 18px;
  color: #333;
  margin: 0;
}

.more-link {
  color: #999;
  text-decoration: none;
  font-size: 14px;
}

.product-list {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
}

.product-card {
  border-radius: 8px;
  overflow: hidden;
  background-color: #fff;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.product-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.product-image {
  position: relative;
  height: 200px;
  overflow: hidden;
  border-radius: 8px 8px 0 0;
  background: linear-gradient(135deg, #f8f8f8 0%, #e0e0e0 100%);
  display: flex;
  justify-content: center;
  align-items: center;
}

.product-image::before {
  content: attr(data-name);
  position: absolute;
  font-size: 16px;
  font-weight: bold;
  color: #666;
  text-align: center;
  padding: 0 10px;
  z-index: 1;
  display: none; /* éšè—é‡å çš„æ–‡å­— */
}

.product-image img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  transition: all 0.3s ease;
  z-index: 2;
}

.product-image img:not([src]), 
.product-image img[src=""], 
.product-image img[src="error"],
.product-image img[src$="undefined"] {
  opacity: 0;
}

.product-card:hover .product-image img {
  transform: scale(1.05);
}

.product-info {
  padding: 15px;
}

.product-name {
  font-size: 16px;
  font-weight: 500;
  margin: 0 0 8px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.product-desc {
  font-size: 12px;
  color: #666;
  margin: 0 0 10px;
  height: 36px;
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

.product-price {
  font-size: 18px;
  font-weight: bold;
  color: #ff4d4f;
  margin-bottom: 10px;
}

.add-to-cart-btn {
  width: 100%;
  height: 36px;
  background-color: #ff4d4f;
  color: #fff;
  border: none;
  border-radius: 18px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.add-to-cart-btn:hover {
  background-color: #ff7875;
}

/* çƒ­é”€å•†å“åŒºåŸŸæ ·å¼ */
.hot-products {
  background-color: #fff;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.section-header h2 {
  font-size: 18px;
  color: #333;
  margin: 0;
}

.more-link {
  color: #999;
  text-decoration: none;
  font-size: 14px;
}

.product-list {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
}

.product-card {
  border-radius: 8px;
  overflow: hidden;
  background-color: #fff;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.product-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.product-image {
  position: relative;
  height: 200px;
  overflow: hidden;
  border-radius: 8px 8px 0 0;
  background: linear-gradient(135deg, #f8f8f8 0%, #e0e0e0 100%);
  display: flex;
  justify-content: center;
  align-items: center;
}

.product-image::before {
  content: attr(data-name);
  position: absolute;
  font-size: 16px;
  font-weight: bold;
  color: #666;
  text-align: center;
  padding: 0 10px;
  z-index: 1;
  display: none; /* éšè—é‡å çš„æ–‡å­— */
}

.product-image img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  transition: all 0.3s ease;
  z-index: 2;
}

.product-image img:not([src]), 
.product-image img[src=""], 
.product-image img[src="error"],
.product-image img[src$="undefined"] {
  opacity: 0;
}

.product-card:hover .product-image img {
  transform: scale(1.05);
}

.product-info {
  padding: 15px;
}

.product-name {
  font-size: 16px;
  font-weight: 500;
  margin: 0 0 8px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.product-desc {
  font-size: 12px;
  color: #666;
  margin: 0 0 10px;
  height: 36px;
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

.product-price {
  font-size: 18px;
  font-weight: bold;
  color: #ff4d4f;
  margin-bottom: 10px;
}

.add-to-cart-btn {
  width: 100%;
  height: 36px;
  background-color: #ff4d4f;
  color: #fff;
  border: none;
  border-radius: 18px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.add-to-cart-btn:hover {
  background-color: #ff7875;
}

/* å®¢æœæµ®åŠ¨æŒ‰é’®æ ·å¼ */
.chat-float-btn {
  position: fixed;
  bottom: 30px;
  right: 30px;
  background-color: #ff4d4f;
  color: white;
  border-radius: 50px;
  padding: 15px 20px;
  display: flex;
  align-items: center;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(255, 77, 79, 0.4);
  z-index: 999;
  transition: all 0.3s;
}

.chat-float-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 16px rgba(255, 77, 79, 0.5);
}

.chat-icon {
  width: 24px;
  height: 24px;
}

.chat-float-btn span {
  margin-left: 10px;
  font-size: 14px;
  font-weight: bold;
}

/* èŠå¤©å¼¹çª—æ ·å¼ */
.chat-popup {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 360px;
  height: 500px;
  background-color: white;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  display: flex;
  flex-direction: column;
  z-index: 1000;
  overflow: hidden;
}

.chat-popup-header {
  background-color: #ff4d4f;
  padding: 15px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.chat-popup-header h3 {
  margin: 0;
  font-size: 16px;
  color: white;
  font-weight: 500;
}

.close-btn {
  background: none;
  color: white;
  border: none;
  font-size: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
}

.chat-popup-messages {
  flex: 1;
  overflow-y: auto;
  padding: 15px;
  background-color: #f8f8f8;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.popup-message {
  max-width: 80%;
  padding: 12px 16px;
  border-radius: 16px;
  position: relative;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.popup-user-message {
  align-self: flex-end;
  background-color: #ff4d4f;
  color: white;
  border-bottom-right-radius: 4px;
}

.popup-assistant-message {
  align-self: flex-start;
  background-color: white;
  color: #333;
  border-bottom-left-radius: 4px;
}

.popup-message-content {
  white-space: pre-wrap;
  line-height: 1.5;
  font-size: 14px;
}

.popup-message-content :deep(p) {
  margin: 0;
}

/* æ¶ˆæ¯ä¸­çš„å›¾ç‰‡æ ·å¼ */
.message-image {
  margin-bottom: 8px;
  max-width: 100%;
}

.message-image img {
  max-width: 100%;
  max-height: 200px;
  border-radius: 8px;
  object-fit: contain;
}

.chat-popup-input {
  display: flex;
  gap: 8px;
  padding: 12px;
  background-color: white;
  border-top: 1px solid #eee;
}

.chat-popup-input input {
  flex: 1;
  height: 40px;
  padding: 0 15px;
  border: 1px solid #ddd;
  border-radius: 20px;
  outline: none;
  font-size: 14px;
}

.chat-popup-input input:focus {
  border-color: #ff4d4f;
}

.chat-popup-input .upload-btn {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  padding: 0;
  border: none;
  background: #f5f5f5;
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.3s;
}

.chat-popup-input .upload-btn:hover {
  background: #e0e0e0;
}

.chat-popup-input .upload-btn svg {
  width: 20px;
  height: 20px;
}

.chat-popup-input .send-btn {
  width: 70px;
  height: 40px;
  background-color: #ff4d4f;
  color: white;
  border: none;
  border-radius: 20px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
}

/* åº•éƒ¨åŒºåŸŸæ ·å¼ */
.footer {
  background-color: #fff;
  padding: 30px 20px;
  margin-top: 30px;
}

.footer-links {
  display: flex;
  justify-content: space-around;
  padding: 30px 0;
  max-width: 1200px;
  margin: 0 auto;
}

.link-group h3 {
  font-size: 16px;
  color: #333;
  margin-bottom: 15px;
}

.link-group ul {
  list-style: none;
  padding: 0;
}

.link-group li {
  margin-bottom: 10px;
}

.link-group a {
  color: #666;
  text-decoration: none;
  font-size: 12px;
}

.link-group a:hover {
  color: #ff4d4f;
}

.copyright {
  text-align: center;
  color: #999;
  font-size: 12px;
  padding-top: 20px;
  border-top: 1px solid #eee;
  max-width: 1200px;
  margin: 0 auto;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .main-content {
    flex-direction: column;
  }
  
  .sidebar {
    width: 100%;
    margin-right: 0;
    margin-bottom: 20px;
  }
  
  .product-list {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .footer-links {
    flex-wrap: wrap;
  }
  
  .link-group {
    width: 50%;
    margin-bottom: 20px;
  }
}

.product-section {
  margin-top: 30px;
  max-width: 1200px;
  margin-left: auto;
  margin-right: auto;
}

.products {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  margin-top: 20px;
}

.service-section {
  margin-top: 40px;
  padding: 20px;
  background-color: #f9f9f9;
  border-radius: 10px;
  max-width: 1200px;
  margin-left: auto;
  margin-right: auto;
}

.quick-links {
  width: 100%;
  background-color: #fff;
  border-bottom: 1px solid #eee;
  margin-bottom: 10px;
}

.quick-links-container {
  width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

.links-list {
  list-style: none;
  padding: 8px 0;
  margin: 0;
  display: flex;
  flex-wrap: wrap;
}

.links-list li {
  margin-right: 15px;
  font-size: 12px;
  line-height: 22px;
}

.links-list a {
  color: #666;
  text-decoration: none;
}

.links-list a:hover {
  color: #ff4d4f;
}
</style> 